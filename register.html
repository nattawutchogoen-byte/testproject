<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <style>
    /* ... (CSS ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ... */
    body {
      background: linear-gradient(180deg, #FFE6E6, #FFF7CC);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container {
      background: #fff;
      padding: 40px 50px;
      border-radius: 30px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      text-align: center;
      max-width: 400px;
      width: 100%;
      animation: popIn 0.6s ease;
    }
    @keyframes popIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    h1 {
      color: #FF6B6B;
      font-size: 2rem;
      margin-bottom: 10px;
    }
    h1::after {
      content: " üéì";
      animation: float 2s infinite ease-in-out;
      display: inline-block;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }
    label {
      display: block;
      text-align: left;
      color: #666;
      font-size: 0.95rem;
      margin-top: 15px;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin: 5px 0 10px 0;
      border: 2px solid #FFD166;
      border-radius: 20px;
      font-size: 1rem;
      outline: none;
      transition: all 0.2s;
      background-color: #fff9e6;
      box-sizing: border-box;
    }
    input:focus, select:focus {
      border-color: #FF6B6B;
      background-color: #fff3f3;
    }
    button {
      background-color: #FF92A5;
      color: white;
      border: none;
      border-radius: 25px;
      padding: 12px 30px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: 0.3s;
      margin-top: 20px;
      box-shadow: 0 4px 8px rgba(255,105,135,0.3);
    }
    #registerBtn {
      width: 100%;
    }
    button:hover {
      background-color: #FF6B6B;
      transform: translateY(-3px);
    }
    button:active {
      transform: translateY(0);
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    .success {
      display: none;
      font-size: 1.2rem;
      color: #4CAF50;
      margin-top: 15px;
      animation: bounce 1s ease;
    }
    .error {
      display: none;
      font-size: 1rem;
      color: #FF6B6B;
      margin-top: 15px;
      animation: bounce 1s ease;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
  </style>
  <link rel="stylesheet" href="sarabun_font.css">
</head>
<body>
  <div class="container">
    <h1>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
    <input type="text" id="name" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
    <label for="level">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô üè´</label>
    <select id="level" onchange="updateGradeOptions()">
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô --</option>
      <option value="‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•</option>
      <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
    </select>
    <label for="grade">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô üìö</label>
    <select id="grade">
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>
    </select>
    <button id="registerBtn" onclick="register()">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <p class="success" id="successMsg">üéâ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
    <p class="error" id="errorMsg" style="display: none;"></p>
  </div>
  <audio id="successSound" src="https://cdn.pixabay.com/download/audio/2023/03/21/audio_cbf29a319e.mp3?filename=correct-answer-3-126467.mp3"></audio>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <script>
    // 2. ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è ‡∏ß‡∏≤‡∏á
    // 2. ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è ‡∏ß‡∏≤‡∏á Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è
   const firebaseConfig = {
  apiKey: "AIzaSyCmcrlQZJAaPleSj55_vFbBbv0tv62orzc",
  authDomain: "iq2gorealtime.firebaseapp.com",
  projectId: "iq2gorealtime",
  storageBucket: "iq2gorealtime.firebasestorage.app",
  messagingSenderId: "53793671216",
  appId: "1:53793671216:web:483d97128a9827458045f5",
  measurementId: "G-GFWPB899WD"
};
    // ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è ----------------------------- ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è

    // 3. ‚≠êÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase ‚≠êÔ∏è
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(); // ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô updateGradeOptions() ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
    function updateGradeOptions() {
      const level = document.getElementById("level").value;
      const grade = document.getElementById("grade");
      grade.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>';
      if (level === "‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•") {
        ["‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 1", "‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2", "‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 3"].forEach(lv => {
          const opt = document.createElement("option");
          opt.value = lv;
          opt.textContent = lv;
          grade.appendChild(opt);
        });
      } else if (level === "‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤") {
        ["‡∏õ.1", "‡∏õ.2", "‡∏õ.3", "‡∏õ.4", "‡∏õ.5", "‡∏õ.6"].forEach(lv => {
          const opt = document.createElement("option");
          opt.value = lv;
          opt.textContent = lv;
          grade.appendChild(opt);
        });
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß!)
     */
    async function register() {
      const name = document.getElementById("name").value.trim();
      const level = document.getElementById("level").value;
      const grade = document.getElementById("grade").value;
      const successMsg = document.getElementById("successMsg");
      const errorMsg = document.getElementById("errorMsg");
      const registerBtn = document.getElementById("registerBtn");
      const sound = document.getElementById("successSound");

      successMsg.style.display = "none";
      errorMsg.style.display = "none";

      if (!name || !level || !grade) {
        errorMsg.textContent = "‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
        errorMsg.style.display = "block";
        return;
      }

      registerBtn.disabled = true;
      registerBtn.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...";

      const registrationData = {
        name: name,
        level: level,
        grade: grade,
        date: new Date().toLocaleString("th-TH")
      };

      try {
        // --- 4. ‚≠êÔ∏è ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‚≠êÔ∏è ---
        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà Firebase
        await db.collection("students").add({
          ...registrationData,
          timestamp: firebase.firestore.FieldValue.serverTimestamp() // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
        });
        // ------------------------------------

        // --- ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ---
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö userLogs)
        const logs = JSON.parse(localStorage.getItem("userLogs") || "[]");
        logs.push(registrationData);
        localStorage.setItem("userLogs", JSON.stringify(logs));

        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ success
        localStorage.setItem("currentRegistration", JSON.stringify(registrationData));

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        successMsg.style.display = "block";
        sound.play();

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ (‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
        let nextPage = "";
        if (grade.startsWith("‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•")) {
          nextPage = "kid1-3.html";
        } else if (grade.startsWith("‡∏õ.")) {
          const gradeNum = grade.replace("‡∏õ.", "");
          nextPage = `p${gradeNum}.html`;
        } else {
          nextPage = "index.html";
        }

        // ‡∏ô‡∏≥‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î
        setTimeout(() => {
          window.location.href = nextPage;
        }, 1500);
        // --- ‡∏à‡∏ö‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏° ---

      } catch (error) {
        // ‡∏ñ‡πâ‡∏≤ Firebase ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
        console.error("Error adding document: ", error);
        errorMsg.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        errorMsg.style.display = "block";
        registerBtn.disabled = false;
        registerBtn.textContent = "‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
      }
    }
  </script>

</body>
</html>